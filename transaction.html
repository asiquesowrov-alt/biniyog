<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#0f172a;
  color:#fff;
}
.header{
  padding:15px;
  background:#020617;
  font-size:20px;
  font-weight:bold;
}
.container{
  padding:15px;
}
.card{
  background:#020617;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
  font-size:14px;
}
.amount{font-size:18px;font-weight:bold}
.pending{color:#facc15}
.approved{color:#22c55e}
.rejected{color:#ef4444}
.small{color:#94a3b8;font-size:13px}
</style>
</head>

<body>

<div class="header">ðŸ”„ Transaction History</div>

<div class="container" id="list">
  Loading...
</div>

<!-- ðŸ”¥ FIREBASE TRANSACTION LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
  getFirestore, 
  collection, 
  query, 
  where, 
  getDocs,
  orderBy 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
  projectId: "biniyog-95d00"
});

const auth = getAuth(app);
const db = getFirestore(app);
const list = document.getElementById("list");

onAuthStateChanged(auth, async(user)=>{
  if(!user){
    location.href="index.html";
    return;
  }

  const q = query(
    collection(db,"deposits"),
    where("uid","==",user.uid),
    orderBy("createdAt","desc")
  );

  const snap = await getDocs(q);
  list.innerHTML="";

  if(snap.empty){
    list.innerHTML = "âŒ à¦•à§‹à¦¨à§‹ Transaction à¦¨à§‡à¦‡";
    return;
  }

  snap.forEach(d=>{
    const t = d.data();
    let statusClass = "pending";
    let statusText = "Pending";

    if(t.status==="approved"){
      statusClass="approved";
      statusText="Approved";
    }
    if(t.status==="rejected"){
      statusClass="rejected";
      statusText="Rejected";
    }

    const div = document.createElement("div");
    div.className="card";
    div.innerHTML = `
      <div class="amount">à§³ ${t.amount}</div>
      <div class="small">Transaction ID: ${t.trxId}</div>
      <div class="${statusClass}">Status: ${statusText}</div>
    `;
    list.appendChild(div);
  });
});
</script>

</body>
</html>
