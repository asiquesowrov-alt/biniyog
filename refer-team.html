<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Biniyog | My Team</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
.header{background:#065f46;color:#fff;padding:15px;text-align:center}
.card{background:#fff;margin:15px;padding:15px;border-radius:12px}
.level{
  margin:10px 0;
  padding:10px;
  border-radius:8px;
}
.l1{background:#ecfeff}
.l2{background:#f0fdf4}
.l3{background:#fefce8}
.l4{background:#fdf2f8}
.user{
  padding:6px 0;
  border-bottom:1px solid #ddd;
  font-size:14px;
}
.user:last-child{border:none}
.badge{
  font-size:12px;
  padding:2px 6px;
  border-radius:6px;
  margin-left:5px;
}
.b1{background:#22c55e;color:#fff}
.b2{background:#3b82f6;color:#fff}
.b3{background:#f59e0b;color:#000}
.b4{background:#ec4899;color:#fff}
.back{text-align:center;margin:15px}
.back a{text-decoration:none;color:#065f46;font-weight:bold}
</style>
</head>

<body>

<script>
const user = localStorage.getItem("loggedInUser");
if(!user){ location.href="index.html"; }
</script>

<div class="header">
<h2>üå≥ My Refer Team</h2>
<p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï</p>
</div>

<div class="card" id="team"></div>

<div class="back">
<a href="dashboard.html">‚¨Ö Dashboard</a>
</div>

<script>
let refs = JSON.parse(localStorage.getItem("refers")) || [];
let users = JSON.parse(localStorage.getItem("users")) || [];

function getChildren(parent){
  return refs.filter(r => r.parent === parent).map(r => r.user);
}

function buildLevels(){
  let level1 = getChildren(user);
  let level2 = [];
  let level3 = [];
  let level4 = [];

  level1.forEach(u=>{
    getChildren(u).forEach(x=>level2.push(x));
  });

  level2.forEach(u=>{
    getChildren(u).forEach(x=>level3.push(x));
  });

  level3.forEach(u=>{
    getChildren(u).forEach(x=>level4.push(x));
  });

  let html = "";

  html += renderLevel("Level 1 (‡ß≥100 Direct)", level1, "l1","b1");
  html += renderLevel("Level 2 (12%)", level2, "l2","b2");
  html += renderLevel("Level 3 (5%)", level3, "l3","b3");
  html += renderLevel("Hand to Hand (2%)", level4, "l4","b4");

  document.getElementById("team").innerHTML = html;
}

function renderLevel(title, list, cls, badge){
  if(list.length === 0){
    return `
      <div class="level ${cls}">
        <b>${title}</b>
        <div class="user">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡ßá‡¶á</div>
      </div>
    `;
  }

  let html = `
    <div class="level ${cls}">
      <b>${title}</b>
  `;

  list.forEach(u=>{
    html += `
      <div class="user">
        üì± ${u}
        <span class="badge ${badge}">${title.split(" ")[0]}</span>
      </div>
    `;
  });

  html += `</div>`;
  return html;
}

buildLevels();
</script>

</body>
</html>
