<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Biniyog | Withdraw</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
.header{background:#dc2626;color:#fff;padding:15px;text-align:center}
.card{background:#fff;margin:15px;padding:15px;border-radius:12px}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  background:#dc2626;
  color:#fff;
  border:none;
  font-size:16px;
}
.note{
  background:#fef2f2;
  padding:10px;
  border-radius:8px;
  margin-top:10px;
  font-size:14px;
}
.back{text-align:center;margin:15px}
.back a{text-decoration:none;color:#dc2626;font-weight:bold}
</style>
</head>

<body>

<script>
const user = localStorage.getItem("loggedInUser");
if(!user){ location.href="index.html"; }
</script>

<div class="header">
<h2>üí∏ Withdraw Request</h2>
</div>

<div class="card">
<label>Withdraw Amount (‡ß≥)</label>
<input type="number" id="amount" placeholder="Minimum 500">

<label>Payment Method</label>
<select id="method">
  <option value="">Select Method</option>
  <option value="bKash">bKash</option>
  <option value="Nagad">Nagad</option>
  <option value="Rocket">Rocket</option>
</select>

<label>Mobile Number</label>
<input type="tel" id="number" placeholder="Payment number">

<button onclick="requestWithdraw()">Submit Withdraw</button>

<div class="note">
üîî <b>Withdraw Rules:</b><br>
‚Ä¢ Minimum Withdraw ‡ß≥500<br>
‚Ä¢ Balance ‡¶ï‡¶Æ ‡¶π‡¶≤‡ßá Withdraw ‡¶π‡¶¨‡ßá ‡¶®‡¶æ<br>
‚Ä¢ Withdraw Pending ‡¶•‡¶æ‡¶ï‡¶¨‡ßá<br>
‚Ä¢ Admin Approve ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡¶¨‡ßá
</div>
</div>

<div class="back">
<a href="dashboard.html">‚¨Ö Dashboard</a>
</div>

<script>
function getBalance(){
  let deposits = JSON.parse(localStorage.getItem("deposits"))||[];
  let withdraws = JSON.parse(localStorage.getItem("withdraws"))||[];
  let d=0,w=0;

  deposits.filter(x=>x.user===user)
    .forEach(x=>d+=Number(x.amount));

  withdraws.filter(x=>x.user===user && x.status==="approved")
    .forEach(x=>w+=Number(x.amount));

  return d-w;
}

function requestWithdraw(){
  let amount = Number(document.getElementById("amount").value);
  let method = document.getElementById("method").value;
  let number = document.getElementById("number").value.trim();

  if(amount < 500){
    alert("‚ùå Minimum Withdraw ‡ß≥500");
    return;
  }

  if(amount > getBalance()){
    alert("‚ùå ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á");
    return;
  }

  if(method === "" || number === ""){
    alert("‚ùå ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
    return;
  }

  let withdraws = JSON.parse(localStorage.getItem("withdraws")) || [];

  withdraws.push({
    user: user,
    amount: amount,
    method: method,
    number: number,
    status: "pending",
    time: Date.now()
  });

  localStorage.setItem("withdraws", JSON.stringify(withdraws));

  alert("‚úÖ Withdraw Request Submitted (Pending)");

  document.getElementById("amount").value = "";
  document.getElementById("number").value = "";
}
</script>

</body>
</html>
