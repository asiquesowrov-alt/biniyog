<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Investment Plan</title>

<style>
body{margin:0;font-family:Arial;background:#fdecec}
.header{padding:16px;text-align:center;font-size:22px;font-weight:bold}
.plan{
 background:#b23a1e;color:#fff;margin:15px;
 border-radius:18px;padding:20px;text-align:center
}
.plan h3{margin:5px 0}
.plan p{margin:4px 0;font-size:15px}
.buy{
 margin-top:12px;background:#facc15;border:none;
 padding:10px 26px;border-radius:20px;
 font-weight:bold;cursor:pointer
}
</style>
</head>

<body>

<div class="header">ржЗржиржнрзЗрж╕рзНржЯржорзЗржирзНржЯ ржкрзНрж▓рж╛ржи</div>

<!-- PLANS -->
<div class="plan">
<h3>ржорж┐ржирж┐ ржкрзНрж▓рж╛ржи</h3>
<p>рз│500</p>
<p>рзирзкржШржирзНржЯрж╛рзЯ ржЖрзЯ рз│90</p>
<p>ржорзЗрзЯрж╛ржж: рззрзж ржжрж┐ржи</p>
<button class="buy" onclick="buyPlan('Mini',500,90,10)">ржХрж┐ржирзБржи</button>
</div>

<div class="plan">
<h3>ржЙржЗржбржорж┐рж▓ ржкрзНрж▓рж╛ржи</h3>
<p>рз│1000</p>
<p>рзирзкржШржирзНржЯрж╛рзЯ ржЖрзЯ рз│197</p>
<p>ржорзЗрзЯрж╛ржж: рззрзж ржжрж┐ржи</p>
<button class="buy" onclick="buyPlan('Windmill',1000,197,10)">ржХрж┐ржирзБржи</button>
</div>

<div class="plan">
<h3>рж╢рзЗрзЯрж╛рж░ ржкрзНрж▓рж╛ржи</h3>
<p>рз│2000</p>
<p>рзирзкржШржирзНржЯрж╛рзЯ ржЖрзЯ рз│470</p>
<p>ржорзЗрзЯрж╛ржж: рззрзж ржжрж┐ржи</p>
<button class="buy" onclick="buyPlan('Share-2000',2000,470,10)">ржХрж┐ржирзБржи</button>
</div>

<div class="plan">
<h3>рж╢рзЗрзЯрж╛рж░ ржкрзНрж▓рж╛ржи</h3>
<p>рз│5000</p>
<p>рзирзкржШржирзНржЯрж╛рзЯ ржЖрзЯ рз│1280</p>
<p>ржорзЗрзЯрж╛ржж: рззрзж ржжрж┐ржи</p>
<button class="buy" onclick="buyPlan('Share-5000',5000,1280,10)">ржХрж┐ржирзБржи</button>
</div>

<div class="plan">
<h3>ржирзНржпрж╛рж╢ржирж╛рж▓ ржкрзНрж▓рж╛ржи</h3>
<p>рз│20000</p>
<p>рзирзкржШржирзНржЯрж╛рзЯ ржЖрзЯ рз│5487</p>
<p>ржорзЗрзЯрж╛ржж: рзм ржжрж┐ржи</p>
<button class="buy" onclick="buyPlan('National',20000,5487,6)">ржХрж┐ржирзБржи</button>
</div>

<div class="plan">
<h3>ржорзЗржЧрж╛ ржкрзНрж▓рж╛ржи</h3>
<p>рз│50000</p>
<p>рзирзкржШржирзНржЯрж╛рзЯ ржЖрзЯ рз│13485</p>
<p>ржорзЗрзЯрж╛ржж: рзм ржжрж┐ржи</p>
<button class="buy" onclick="buyPlan('Mega',50000,13485,6)">ржХрж┐ржирзБржи</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
 getFirestore,doc,getDoc,updateDoc,
 addDoc,collection,serverTimestamp 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
 projectId:"biniyog-95d00"
});

const auth=getAuth(app);
const db=getFirestore(app);
let uid=null;

onAuthStateChanged(auth,user=>{
 if(!user) location.href="index.html";
 uid=user.uid;
});

window.buyPlan = async(planName,price,daily,days)=>{
 if(!uid){ alert("рж▓рзЛржб рж╣ржЪрзНржЫрзЗ, ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи"); return; }

 const uref=doc(db,"users",uid);
 const snap=await getDoc(uref);
 const bal=snap.data().balance||0;

 if(bal<price){
  alert("ржкрж░рзНржпрж╛ржкрзНржд ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржирзЗржЗ");
  return;
 }

 // тЬЕ Balance deduct
 await updateDoc(uref,{
  balance: bal - price
 });

 // тЬЕ Save plan for Task page
 await addDoc(collection(db,"user_plans"),{
  uid,
  planName,
  price,
  daily,
  days,
  totalEarn: daily * days,
  earned: 0,
  startAt: serverTimestamp(),
  endAt: Date.now() + days*86400000,
  status:"running"
 });

 // ЁЯОЙ Congratulations message
 alert("ЁЯОЙ Congratulations!\nржЖржкржирж┐ рж╕ржлрж▓ржнрж╛ржмрзЗ ржкрзНрж▓рж╛ржи ржХрж┐ржирзЗржЫрзЗржи");

 // Go to Task
 location.href="task.html";
};
</script>

</body>
</html>
