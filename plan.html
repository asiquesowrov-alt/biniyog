<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Investment Plan</title>

<style>
body{margin:0;font-family:Arial;background:#fdecec}
.header{padding:16px;text-align:center;font-size:22px;font-weight:bold}
.plan{
 background:#b23a1e;color:#fff;margin:15px;
 border-radius:18px;padding:20px;text-align:center
}
.plan h3{margin:5px 0}
.plan p{margin:4px 0;font-size:15px}
.buy{
 margin-top:12px;background:#facc15;border:none;
 padding:10px 26px;border-radius:20px;
 font-weight:bold;cursor:pointer
}
</style>
</head>

<body>

<div class="header">ইনভেস্টমেন্ট প্লান</div>

<!-- PLANS -->
<div class="plan">
<h3>মিনি প্লান</h3>
<p>৳500</p>
<p>২৪ঘন্টায় আয় ৳90</p>
<p>মেয়াদ: ১০ দিন</p>
<button class="buy" onclick="buyPlan('Mini',500,90,10)">কিনুন</button>
</div>

<div class="plan">
<h3>উইডমিল প্লান</h3>
<p>৳1000</p>
<p>২৪ঘন্টায় আয় ৳197</p>
<p>মেয়াদ: ১০ দিন</p>
<button class="buy" onclick="buyPlan('Windmill',1000,197,10)">কিনুন</button>
</div>

<div class="plan">
<h3>শেয়ার প্লান</h3>
<p>৳2000</p>
<p>২৪ঘন্টায় আয় ৳470</p>
<p>মেয়াদ: ১০ দিন</p>
<button class="buy" onclick="buyPlan('Share-2000',2000,470,10)">কিনুন</button>
</div>

<div class="plan">
<h3>শেয়ার প্লান</h3>
<p>৳5000</p>
<p>২৪ঘন্টায় আয় ৳1280</p>
<p>মেয়াদ: ১০ দিন</p>
<button class="buy" onclick="buyPlan('Share-5000',5000,1280,10)">কিনুন</button>
</div>

<div class="plan">
<h3>ন্যাশনাল প্লান</h3>
<p>৳20000</p>
<p>২৪ঘন্টায় আয় ৳5487</p>
<p>মেয়াদ: ৬ দিন</p>
<button class="buy" onclick="buyPlan('National',20000,5487,6)">কিনুন</button>
</div>

<div class="plan">
<h3>মেগা প্লান</h3>
<p>৳50000</p>
<p>২৪ঘন্টায় আয় ৳13485</p>
<p>মেয়াদ: ৬ দিন</p>
<button class="buy" onclick="buyPlan('Mega',50000,13485,6)">কিনুন</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
 getFirestore,doc,getDoc,updateDoc,
 addDoc,collection,serverTimestamp 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
 projectId:"biniyog-95d00"
});

const auth=getAuth(app);
const db=getFirestore(app);
let uid=null;

onAuthStateChanged(auth,user=>{
 if(!user) location.href="index.html";
 uid=user.uid;
});

window.buyPlan = async(planName,price,daily,days)=>{
 if(!uid){ alert("লোড হচ্ছে, আবার চেষ্টা করুন"); return; }

 const uref=doc(db,"users",uid);
 const snap=await getDoc(uref);
 const bal=snap.data().balance||0;

 if(bal<price){
  alert("পর্যাপ্ত ব্যালেন্স নেই");
  return;
 }

 // deduct balance
 await updateDoc(uref,{ balance: bal-price });

 // save plan (GLOBAL collection)
 await addDoc(collection(db,"user_plans"),{
  uid,
  planName,
  price,
  daily,
  days,
  totalEarn: daily*days,
  start: Date.now(),
  end: Date.now() + days*86400000,
  status:"running",
  createdAt: serverTimestamp()
 });

 alert("প্ল্যান সফলভাবে কেনা হয়েছে");
 location.href="task.html";
};
</script>

</body>
</html>
