<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Task</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#87CEEB;
}
.header{
    background:#0288d1;
    color:#fff;
    text-align:center;
    padding:15px;
    font-size:22px;
}
.card{
    background:#fff;
    margin:20px;
    padding:20px;
    border-radius:14px;
}
.card h3{
    margin-top:0;
    color:#0288d1;
}
.balance{
    font-size:20px;
    font-weight:bold;
    color:green;
}
.end{
    color:red;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="header">Task / My Plan</div>

<div class="card" id="taskBox">
‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
</div>

<script>
let balance = Number(localStorage.getItem("balance")) || 0;
let plan = JSON.parse(localStorage.getItem("activePlan"));

function saveBalance(v){
    localStorage.setItem("balance", v);
}

function dailyIncomeSystem(){

    if(!plan){
        document.getElementById("taskBox").innerHTML = "‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶™‡ßç‡¶≤‡¶æ‡¶® ‡¶®‡ßá‡¶á";
        return;
    }

    let today = new Date();
    let todayStr = today.toDateString();
    let lastPaid = localStorage.getItem("lastIncomeDate");

    let buyDate = new Date(plan.buyDate);
    let endDate = new Date(plan.endDate);

    /* üü• PLAN FINISHED */
    if(today > endDate){

        // üëâ Principal + Final Profit ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡¶á ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá
        if(!plan.completed){
            balance += plan.price;        // principal
            balance += plan.dailyIncome;  // last profit

            saveBalance(balance);

            plan.completed = true;
            localStorage.setItem("activePlan", JSON.stringify(plan));
        }

        document.getElementById("taskBox").innerHTML = `
            <h3>${plan.name}</h3>
            <p>‡¶™‡ßç‡¶≤‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${plan.price}</p>
            <p class="end">‡¶™‡ßç‡¶≤‡¶æ‡¶® ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑</p>
            <p class="balance">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${balance}</p>
        `;
        return;
    }

    /* üü¢ DAILY INCOME (‡ßß ‡¶¶‡¶ø‡¶® = ‡ßß ‡¶¨‡¶æ‡¶∞) */
    if(lastPaid !== todayStr){
        balance += plan.dailyIncome;
        saveBalance(balance);
        localStorage.setItem("lastIncomeDate", todayStr);
    }

    document.getElementById("taskBox").innerHTML = `
        <h3>${plan.name}</h3>
        <p>‡¶™‡ßç‡¶≤‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${plan.price}</p>
        <p>‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${buyDate.toLocaleDateString()}</p>
        <p>‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑: ${endDate.toLocaleDateString()}</p>
        <p>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ü‡ßü: ‡ß≥${plan.dailyIncome}</p>
        <p class="balance">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${balance}</p>
    `;
}

dailyIncomeSystem();
</script>

</body>
</html>
